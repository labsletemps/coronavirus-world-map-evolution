<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/style.css?UPDATE" />
	<style>
	body{
		border-bottom: none;
		padding: 0;
		margin: 0;
	}
	.outline {
		border: 1px solid #ccc;
		border-radius: 3px;
	}
	h5{
		/* float: left; */
		margin-top: .5em;
	}
	a, a:visited, a:hover{
		color: #000;
	}
	.multiline svg{
		margin-bottom: .5em;
	}
	h5{
		font-size: 1.3em;
	}
	h6{
		margin-top: 6px;
		margin-bottom: 3px;
	}
	@media screen and (max-width: 500px) {
		h5{
			font-size: 1.2rem;
		}
	}
	.notwebapp .www_only{
		display: none;
	}

	@media (prefers-color-scheme: dark) {
		body.notwebapp{
			background-color: #262626;
		}
		.notwebapp h5, .notwebapp h6, .notwebapp a, .notwebapp a:visited, .notwebapp a:hover{
			color: #ddd;
		}
		.notwebapp .multiline svg{
			background-color: #111;
			border-color: #999;
		}
		.notwebapp .multiline text{
			color: #fff;
		}
		.notwebapp .btn-outline-primary{
			color: #fff;
			background-color: #375a7f;
			border-color: #375a7f;
		}
	}

	</style>
</head>

<body class="notwebapp">
	<div class="container">

		<div class="row align-items-top">

			<div class="col-12 group-label">
				<h5><a target="_blank" href="https://labs.letemps.ch/interactive/2020/carte-coronavirus-monde/">Le Covid-19 en Suisse</a></h5>
				<a target="_blank" href="https://labs.letemps.ch/interactive/2020/carte-coronavirus-monde/" class="btn btn-outline-primary btn-sm">Voir tous les graphiques</a>

				<h6>Bilans quotidiens, aplanis par une moyenne mobile</h6>
				<div class="multiline" id="chartDailyTestsCH"></div>

				<h6>Taux de reproduction effectif (Re)</h6>
				<div class="multiline" id="reMeanCH"></div>

			</div>

		</div>
	</div>

	<script src="lib/d3.min.js"></script>
	<script src="lib/d3-annotation.min.js"></script>
	<script src="js/multiLineChart.js"></script>

	<script>

	function setText(selector, text){
		var el = document.querySelector(selector);
		el.innerText = text;
	}
	var height = Math.max( document.body.offsetHeight,
                       document.documentElement.clientHeight, document.documentElement.offsetHeight );

	if(height > 400){
		document.body.classList.remove('notwebapp');
	}

	// update chaque 100 seconde
	var d = new Date();
	var update = Math.round(d.getTime() / 10000)

	var timeLocale = {
		"dateTime": "%A %e %B %Y",
		"date": "%d/%m/%Y",
		"time": "%H:%M:%S",
		"periods": ["AM", "PM"],
		"days": ["dimanche", "lundi", "mardi", "mercredi", "jeudi", "vendredi", "samedi"],
		"shortDays": ["dim.", "lun.", "mar.", "mer.", "jeu.", "ven.", "sam."],
		"months": ["janvier", "février", "mars", "avril", "mai", "juin", "juillet", "août", "septembre", "octobre", "novembre", "décembre"],
		"shortMonths": ["janv.", "févr.", "mars", "avr.", "mai", "juin", "juil.", "août", "sept.", "oct.", "nov.", "déc."]
	}
	d3.timeFormatDefaultLocale(timeLocale);

	var chartDailyTestsCH = new multilineChart({
		'selector': '#chartDailyTestsCH',
		'colors': ['#1f77b4', '#222', '#89C4C9', '#aaa'],
		'file': 'data/ch-daily-cases-and-tests-rolling.csv?' + update,
		'timeScale': true, 'logScale': true,
		'yTickFormat': "d", 'hideLabel': false,
		'annotationSplitter': /\n/,
		'height': 100,
		'margin': {top: 10, left: 50, right: 70, bottom: 25},
		'needsRectlayer': true
	});

	var reMeanCH = new multilineChart({'selector': '#reMeanCH',
	 'height': 100,
	 'margin': {'top': 10, 'left': 50, 'right': 70, 'bottom': 25},
	 'file': 'data/re_switzerland.csv?' + update,
	 'timeScale': true,
	 'yTickFormat': ".2n",
	 'hideLabel': false,
	 'hasConfidenceInterval': true,
	 'xMin': true,
	 'straightLine': false,
	 'needsReLimit': true
 });


	</script>
</body>
</html>
