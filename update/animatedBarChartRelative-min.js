$(document).ready((function(){var t,a=!1;d3.timeFormatDefaultLocale({dateTime:"%A %e %B %Y",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],shortDays:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],months:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],shortMonths:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."]});var e,r=d3.timeFormat("%c"),n="Chine",i=[],o=1,s=40,c=10,d=124,l=20,m=parseInt(d3.select("#animatedBarChart").style("width"))-d-l,u=300-s-c,p=800,h=d3.select("#animatedBarChart").append("svg").attr("width",m+d+l).attr("height",u+s+c).append("g").attr("transform",`translate(${d},${s})`),f=d3.scaleLinear().range([0,m]),y=d3.scaleBand().rangeRound([0,u]).paddingInner(.1),v=d3.axisTop().scale(f),x=h.append("g").attr("class","x axis"),g=d3.axisLeft().scale(y),P=h.append("g").attr("class","y axis");function b(t,a){f.domain([0,d3.max(t,t=>t.casesPerPop)]).nice(),y.domain(t.map(t=>t.country)),x.transition().call(v.ticks(5).tickFormat(d3.format(".0s"))),P.transition().call(g);var e=h.selectAll("rect").data(t,t=>t.country).join(t=>{var a=t.append("rect").attr("x",0).attr("y",u).style("fill",(function(t){return"Italie"==t.country?"#4E8054":"Espagne"==t.country?"#e5b927":"Suisse"==t.country?"#E01649":"#930025"}));return a.append("text").text((function(t){return t.casesPerPop})),a},t=>t,t=>t.remove());e.transition().duration(a).attr("height",y.bandwidth()).attr("width",t=>f(t.casesPerPop)).attr("y",t=>y(t.country));var r=h.selectAll(".textLabels").data(t,t=>t.country).join(t=>{return t.append("text").attr("class","textLabels").attr("x",0).attr("y",u).attr("text-anchor","right").attr("opacity",0).attr("fill","#fff").text((function(t,a){return t.casesPerPop+(0==a?" par mio. d’habitant":"")}))},t=>t,t=>t.remove());e.transition().duration(a).attr("height",y.bandwidth()).attr("width",t=>f(t.casesPerPop)).attr("y",t=>y(t.country)),r.transition().duration(a).attr("height",y.bandwidth()).attr("x",5).attr("opacity",1).attr("y",t=>y(t.country)+16).text((function(t,a){return t.casesPerPop+(0==a?" par mio. d’habitant":"")}))}function j(){b(e.filter(t=>t.timestamp===i[o]).filter(t=>t.country!=n),.8*p),$(".date").text(r(new Date(i[o]))),$(".stop").click((function(){$(".play").removeClass("pause"),clearTimeout(t)})),(o+=1)<i.length?t=setTimeout(j,p):(o-=1,$(".play").removeClass("pause"))}d3.json("data/top_per_pop.json?1594044270445").then(t=>{(e=t).forEach((function(t){-1==i.indexOf(t.timestamp)&&i.push(t.timestamp)})),first_day_data=e.filter(t=>t.timestamp===i[0]).filter(t=>t.country!=n),a=!0,b(first_day_data,.8*p)}),$("#displayChina").change((function(){n=$(this).prop("checked")?"no-filter":"Chine",b(e.filter(t=>t.timestamp===i[o]).filter(t=>t.country!=n),100)}));new ScrollMagic.Scene({triggerElement:"#animatedBarChart",duration:300}).addTo(controller).on("enter",(function(){a&&j()})).on("leave",(function(a){clearTimeout(t)}));$(".reload").click((function(){clearTimeout(t),o=0,j()}))}));