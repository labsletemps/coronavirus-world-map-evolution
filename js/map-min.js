!function(){var t,e=!1,a=0,n=[];d3.timeFormatDefaultLocale({dateTime:"%A %e %B %Y",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],shortDays:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],months:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],shortMonths:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."]});d3.formatLocale({decimal:",",thousands:" ",grouping:[3]}).format(",d");var r=d3.timeFormat("%c"),s=(d3.formatLocale({decimal:",",thousands:" ",grouping:[3]}),600-0-10),i=d3.geoRobinson().scale(190).center([0,12]),l=d3.geoPath().projection(i);Promise.all([d3.json("data/world_countries.json"),d3.csv("data/time-series-ecdc.csv?UPDATE")]).then((function(o){var c=o[0];(o=o[1]).forEach((function(t){-1==n.indexOf(t.timestamp)&&n.push(t.timestamp),t.n=+t.cases_sum})),n.sort();var u=d3.select("#map").append("svg").append("g").attr("id","container");u.append("g").attr("class","countries").selectAll("path").data(c.features).enter().append("path").attr("d",l).style("fill","#888").style("stroke","white").style("opacity",1).style("stroke-width",.3);$("#range_slider").ionRangeSlider({values:n,prettify:function(t){return console.log(t),t},onChange:function(t){a=n.indexOf(t.from_value),d(t.from_value)}});function d(t){u.selectAll(".circles").remove();var e=u.selectAll(".circles").data(o.filter((function(e){return e.timestamp==t})).filter((function(t){return t.cases_sum>0})).sort((function(t,e){return+e.n-+t.n})));e.enter().append("g").attr("class","circles").append("circle").attr("class","circle").attr("cx",(function(t){return i([+t.lng,+t.lat])[0]})).attr("cy",(function(t){return i([+t.lng,+t.lat])[1]})).attr("r",(function(t){return m(+t.n)})).style("fill",(function(t){return"#C32E1E"})).attr("fill-opacity",.5).on("click",(function(t){d3.event.preventDefault(),g(t)})).on("mouseover",(function(t){g(t)})),e.select("circle").transition().duration(150).attr("r",(function(t){return m(+t.n)})).style("fill",(function(t){return"#C32E1E"})),e.exit().remove()}var p=d3.extent(o,(function(t){return+t.n})),m=d3.scalePow().exponent(1/1.75).domain(p).range([2,60]),f=[10,5e4,2e5],v=.75*s;function g(t){d3.select(".map-details").html((function(){var e=t.country;return t["Province/State"]&&(e+=", "+t["Province/State"]),`<h4>${e}</h4>\n\t\t\t\t\t\t<p><span class="stats">Cas confirmés cumulés</span> ${t.cases_sum}</p>\n\t\t\t\t\t\t<p><span class="stats">Décès cumulés</span> ${t.deaths_sum}</p>\n\t\t\t\t\t\t<p><span class="stats">Taux de cas pour un million d’habitants</span> ${t.casesPerPop}</p>\n\t\t\t\t\t\t<p><span class="stats">Taux de décès pour un million d’habitants</span> ${t.deathsPerPop}</p>\n\t\t\t\t\t\t<p><span class="stats">Date</span> ${r(new Date(t.timestamp))}</p>\n\n\t\t\t\t\t`})).style("opacity",1)}function h(){d3.select("g#container").attr("transform","scale("+$("#map").width()/1e3+")"),$("#map svg").height(.5*$("#map").width())}function y(){$("#range_slider").data("ionRangeSlider").update({from:a}),d(n[a]),(a+=1)<n.length?t=setTimeout(y,200):(e=!0,a=0,$(".play").removeClass("pause"))}u.selectAll("legend").data(f).enter().append("circle").attr("cx",80).attr("cy",(function(t){return v-m(t)})).attr("r",(function(t){return m(t)})).style("fill","none").attr("stroke","black"),u.selectAll("legend").data(f).enter().append("line").attr("x1",(function(t){return 80+m(t)})).attr("x2",180).attr("y1",(function(t){return v-m(t)})).attr("y2",(function(t){return v-m(t)})).attr("stroke","black").style("stroke-dasharray","2,2"),u.selectAll("legend").data(f).enter().append("text").attr("x",180).attr("y",(function(t){return v-m(t)})).text((function(t){return t+" cas"})).style("font-size",12).attr("alignment-baseline","middle"),d3.select(window).on("resize",h),h(),$(".play").click((function(){$(this).hasClass("pause")?(clearTimeout(t),$(this).removeClass("pause")):(t=setTimeout(y,200),$(this).addClass("pause"))})),$(".filter-container, .irs-with-grid, .irs, #range_slider").click((function(){$(".play").removeClass("pause"),clearTimeout(t)}));var x;new ScrollMagic.Scene({triggerElement:"#map",duration:300}).addTo(controller).on("enter",(function(){e||(y(),$(".play").addClass("pause"))})).on("leave",(function(e){clearTimeout(t),$(".play").removeClass("pause")})),c3.generate({padding:{top:5,right:30},size:{height:200},bindto:"#time-serie-chart",data:{url:"data/linegraphs-c3.csv?UPDATE",type:"line",x:"timestamp",colors:{"Infections confirmées":"#930025","Guérisons":"#4E8054"}},axis:{x:{type:"timeseries",tick:{format:"%d.%m.%Y",count:4}},y:{tick:{values:[0,2e6,4e6,6e6,8e6],format:function(t){return t>0?t/1e6+" Mio":t}}}},grid:{y:{lines:[{value:0},{value:2e6},{value:4e6},{value:6e6},{value:8e6}]}},tooltip:{format:{value:function(e,r,s,i){if(i!=x){if(i<n.length)d(n[i]),$("#range_slider").data("ionRangeSlider").update({from:i}),clearTimeout(t),$(".pause").removeClass("pause");x=i,a=i}return e}}}});!0}))}();