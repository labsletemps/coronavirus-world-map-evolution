<meta encoding="utf-8">
<style type="text/css">.covid-numbers,
  .covid-numbers p {
    font-size: 15px !important;
  }

  .covid-numbers.hidden {
    display: none;
  }

  /* = titre de ce bloc */
  .covid-numbers .covid {
    font-weight: bold;
    font-size: 1.2em;
    color: #b80021;
  }

  .covid-numbers .big {
    font-weight: bold;
    font-size: 1.2em;
  }

  .covid-numbers i.fa {
    font-size: 20px;
    height: 100%;
    display: block;
    float: left;
    margin-right: .4em;
  }

  .covid-numbers a,
  .covid-numbers a:visited {
    color: #000;
  }

  .covid-numbers .vertical-center {
    min-height: 60px;
    display: flex;
    align-items: center;
  }

  .covid-numbers .border-left {
    border: 1px solid #ccc;
    border-width: 0 0 0 1px;
  }

  .covid-numbers p {
    margin-bottom: 0;
    line-height: 1.2;
  }

  .covid-numbers .icon {
    width: 40px;
    /* todo: illustrator */
    /* https://codepen.io/sosuke/pen/Pjoqqp */
    filter: brightness(0) saturate(100%) invert(9%) sepia(95%) saturate(4550%) hue-rotate(341deg) brightness(89%) contrast(111%);
    margin-right: 5px;
  }

  #chart_title {
    font-size: .8em;
    position: absolute;
    top: 0;
  }

  .multiline {
    width: 100%;
    position: relative;
  }

  .multiline rect {
    /* fill: #ccc; */
    /* debug */
  }

  .multiline .value-label {
    font-size: .8em;
  }

  .multiline .x line {
    display: block;
  }

  /* temp */

  .multiline .country-label {
    font-size: .8em;
  }

  .multiline .x path.domain,
  .multiline .y path.domain,
  .multiline .tick {
    display: none !important;
  }

  .multiline .line {
    fill: none;
    stroke: steelblue;
    stroke-width: 1.5px;
  }

  .multiline .tooltip {
    display: none;
    opacity: 0;
    padding: 4px 10px;
    border: 1px solid #aaa;
    border-radius: 4px;
    position: absolute;
    background-color: white;
    font-size: .8em;
    pointer-events: none;
    -webkit-transition: all 0.25s;
    -moz-transition: all 0.25s;
    -ms-transition: all 0.25s;
    -o-transition: all 0.25s;
    transition: all 0.25s;
  }
  .multiline .annotation-group text{
  	font-size: .9em;
  	text-transform: none !important;
  	font-weight: normal;
  }
  .multiline .country-label{
  	display: none;
  }

  @media screen and (min-width: 770px) {

    /* = titre du bloc de une habituel */
    #block-letemps-content>div>div.block-wrapper.block-wrapper--a-la-une->div>div>div>h2 {
      margin-top: 0;
    }
  }

  @media screen and (max-width: 1220px) {

    .covid-numbers,
    .covid-numbers p {
      font-size: 14px !important;
    }
  }

  @media screen and (max-width: 770px) {
    .covid-numbers {
      font-size: 12px !important;
    }

    .covid-numbers .border-left {
      border-width: 0;
    }

    #covid-banner div[class*='col-'] {
      padding-left: 10px;
      padding-right: 10px;
    }
  }

  @media screen and (max-width: 360px) {
    .covid-numbers {
      display: none;
    }
  }
</style>
<div class="container" id="covid-banner">
  <div class="row">
    <div class="col-12 col-lg-12">
      <div class="row covid-numbers">
        <div class="col-12 col-xs-12 col-sm-4 vertical-center">
          <p><a href="https://labs.letemps.ch/interactive/2020/carte-coronavirus-monde/?ref=desktopbanner" target="_blank"><span class="covid-numbers covid">Covid-19</span>: la Suisse compte <span class="big confirmed_ch">_</span> cas confirmés (+<span class="big increase_ch">___</span> depuis <span class="day_name">___</span> soir) et <span class="big deaths_ch">____</span> décès.</a></p>
        </div>

        <div class="col-12 col-xs-12 col-sm-2 vertical-center"><!-- <span id="chart_title">Nouveaux cas</span> -->
          <div class="multiline" id="chartDailyCH"></div>
        </div>

        <div class="col-4 col-xs-4 col-sm-2 border-left vertical-center"><a href="https://www.letemps.ch/monde/continu-linde-prolonge-douloureux-confinement?ref=desktopbanner" id="current_story_icon" target="_blank"><img class="icon" src="https://labs.letemps.ch/interactive/2020/carte-coronavirus-monde/img/banner/text-box-outline.svg" /></a>

          <p><a href="https://www.letemps.ch/monde/continu-linde-prolonge-douloureux-confinement" id="current_story" target="_blank"><span class="hidden-xs">Notre suivi</span><span class="visible-xs">Suivi</span> en direct</a></p>
        </div>

        <div class="col-4 col-xs-4 col-sm-2 border-left vertical-center"><a href="https://labs.letemps.ch/interactive/2020/carte-coronavirus-monde/?ref=desktopbanner" target="_blank"><img class="icon" src="https://labs.letemps.ch/interactive/2020/carte-coronavirus-monde/img/banner/chart-bell-curve.svg" /></a>

          <p><a href="https://labs.letemps.ch/interactive/2020/carte-coronavirus-monde/?ref=desktopbanner" target="_blank"><span class="hidden-xs">Nos données</span><span class="visible-xs">Données</span> actualisées</a></p>
        </div>

        <div class="col-4 col-xs-4 col-sm-2 border-left vertical-center"><a href="https://www.letemps.ch/podcast/message-viral?ref=desktopbanner" target="_blank"><img class="icon" src="https://labs.letemps.ch/interactive/2020/carte-coronavirus-monde/img/banner/podcast.svg" /></a>

          <p><a href="https://www.letemps.ch/podcast/message-viral?ref=desktopbanner" target="_blank"><span class="hidden-xs">Notre podcast</span><span class="visible-xs">Podcast</span> «Message Viral»</a></p>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  function setText(selector, text) {
    var el = document.querySelector(selector);
    if (el) {
      el.innerText = text;
    } else {
      console.log(selector, 'not found')
    }
  }
  var d = new Date();
  var update = Math.round(d.getTime() / 10000)
  if (window.fetch) {
    fetch('https://labs.letemps.ch/interactive/2020/carte-coronavirus-monde/data/metaAuto.json?' + update)
    .then(function (response) { return response.json(); })
    .then(function (data) {
      var total_mio = Math.round(data['confirmed_total'] / 100000) * 0.1;
      var total_suffix = ' millions';
      setText('.increase_ch', data['increase_ch']);
      // setText('.increase_rate_ch', (data['increase_rate_ch'] >= 0 ? '+' : '') + data['increase_rate_ch'].toLocaleString('fr-FR') + '%');
      setText('.confirmed_ch', data['confirmed_ch'].toLocaleString('fr-FR'));
      setText('.deaths_ch', data['deaths_ch'].toLocaleString('fr-FR'));
      // setText('.cantonsCount', data['cantonsCount']);
      // setText('.dashboardUpdate_ch', data['dashboardUpdate_ch']);
      // setText('.confirmed_total', total_mio.toLocaleString('fr-FR') + total_suffix);
      // setText('.deaths_total', data['deaths_total'].toLocaleString('fr-FR'));
      setText('.day_name', data['day_name']);

    });

    // TODO: dossier si après 19h? https://www.letemps.ch/dossiers/virus-foudroie-monde

    fetch('https://labs.letemps.ch/interactive/2020/carte-coronavirus-monde/data/current_story.json?' + update)
    .then(function (response) { return response.json(); })
    .then(function (data) {
      if (data['hide'] == 'oui') {
        // TODO
        document.getElementById('current_story').href = 'https://www.letemps.ch/dossiers/virus-foudroie-monde?ref=desktopbanner';
        document.getElementById('current_story_icon').href = 'https://www.letemps.ch/dossiers/virus-foudroie-monde?ref=desktopbanner';
        document.getElementById('current_story').innerText = 'Notre dossier sur le Covid-19';
      } else {
        console.log('Ajout de l’URL du direct: ', data['URL'])
        document.getElementById('current_story').href = data['URL'] + '?ref=desktopbanner';
        document.getElementById('current_story_icon').href = data['URL'] + '?ref=desktopbanner';
      }

    });
  } else {
    // TODO
    setText('.error', 'Mise à jour des chiffres impossible: le navigateur est trop ancien');
  }
</script>
<script defer src="https://labs.letemps.ch/interactive/2020/carte-coronavirus-monde/lib/d3.min.js"></script>
<script defer src="https://labs.letemps.ch/interactive/2020/carte-coronavirus-monde/lib/d3-annotation.min.js"></script>
<script defer src="https://labs.letemps.ch/interactive/2020/carte-coronavirus-monde/js/multiLineChart.js?2"></script><script>
var chartDailyCH;

  window.addEventListener('DOMContentLoaded', function() {
    var timeLocale = {
      "dateTime": "%A %e %B %Y",
      "date": "%d/%m/%Y",
      "time": "%H:%M:%S",
      "periods": ["AM", "PM"],
      "days": ["dimanche", "lundi", "mardi", "mercredi", "jeudi", "vendredi", "samedi"],
      "shortDays": ["dim.", "lun.", "mar.", "mer.", "jeu.", "ven.", "sam."],
      "months": ["janvier", "février", "mars", "avril", "mai", "juin", "juillet", "août", "septembre", "octobre", "novembre", "décembre"],
      "shortMonths": ["janv.", "févr.", "mars", "avr.", "mai", "juin", "juil.", "août", "sept.", "oct.", "nov.", "déc."]
    }
    d3.timeFormatDefaultLocale(timeLocale);

    chartDailyCH = new multilineChart({ 'selector': '#chartDailyCH', 'file': 'https://labs.letemps.ch/interactive/2020/carte-coronavirus-monde/data/ch-daily-cases.csv?stg', 'timeScale': true, 'xTickFormat': "d", height: 40, margin: { top: 2, left: 10, right: 10, bottom: 4 } });
    /*setTimeout(function(){

      if( jQuery('#chartDailyCH').width() > 120 ) {
  			chartDailyCH.annotate("1er cas", {x: new Date('2020-02-25'), y: 20}, 10, -20, '25 fév.');
  			chartDailyCH.annotate("Incomplet", {x: new Date(), y: 90}, -10, -10, 'Aujourd’hui');
		    }
      }, 500);*/

  });
</script>
