<!-- [twig template] use '_blocks.html.twig' -->

<!DOCTYPE HTML>

<html>
<head>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<link href='https://fonts.googleapis.com/css?family=Raleway:400,300,700' rel='stylesheet' type='text/css'>
	<link href="https://fonts.googleapis.com/css?family=Montserrat:400,600,800" rel="stylesheet">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/c3.min.css"/>

	<link rel="stylesheet" type="text/css" href="css/style.css?UPDATE" />
	<link rel="stylesheet" type="text/css" href="css/map.css?UPDATE" />
	<link rel="stylesheet" type="text/css" href="css/ion.rangeSlider.css" />
	<style>
	.c3-area {
  	opacity: 0.6 !important;
	}
	.big{
		font-size: 2em;
	}
	.label{
		color: #555;
	}
	</style>
</head>

<body>

	

	<!-- Emplacement pour le contenu principal -->
	<div class="container">

		<div class="row padding-bottom">
			<div class="offset-md-2 col-md-8 col-sm-12">
				<h1 class="intro">L’expansion du nouveau coronavirus</h1>

				<p class="lead">Le 2019-nCov a causé <span class="deaths_total">____</span> décès et plus de <span class="confirmed_total_floor">_____</span> infections confirmées dans le monde, selon les chiffres compilés par l’université Johns-Hopkins</p>

				<p>L’université John-Hopkins, sur la côte est des Etats-Unis, compile les données de la plateforme chinoise <a href="https://3g.dxy.cn/newh5/view/pneumonia?scene=2">DXY.cn</a> et de différentes agences de santé publique et les publie chaque soir vers 18 heures (minuit en Suisse).</p>

				<p>Les infographies suivantes sont régulièrement actualisées depuis le 27 janvier sur la base de ces données. Dernière mise à jour le <span class="update">________________</span>.</p>

			</div>
		</div>

		<div class="row numbers text-center align-items-top padding-bottom">
			<!-- <div class="col-12 text-left">
				Etat au <span class="update"></span>
			</div> -->
			<div class="col-md-3 col-6">
				<span class="big confirmed_total">_____</span><br>
				<span class="label">infections confirmées cumulées</span>
			</div>
			<div class="col-md-3 col-6">
				<span class="big existing_total">___</span><br>
				<span class="label">infections encore existantes</span>
			</div>
			<div class="col-md-3 col-6">
				<span class="big recovered_total">___</span><br>
				<span class="label">guérisons</span>
			</div>
			<div class="col-md-3 col-6">
				<span class="big deaths_total">___</span><br>
				<span class="label">décès</span>
			</div>
		</div>

			<!-- toolbox -->

			<div class="row align-items-end">
				<div class="col-12">
					<div id="time-serie-chart"></div>
				</div>
				<div class="col-10 filter-container">
					<label>Naviguer par date</label>
					<input type="text" id="range_slider" />
				</div>
				<div class="col-2">
					<button id="playpause" class="button play pause"></button>
				</div>
			</div>

			<!-- map container -->
			<div class="row">

				<div class="col-lg-9 col-sm-12">
					<div id="map" class="map">
						<div class="tooltip"></div>
					</div>
				</div>

				<div class="col-lg-3 col-sm-12">
					<div class="map-details">
						<h4></h4>
						<p>Survoler/toucher un cercle pour plus d’informations.</p>
					</div>
				</div>
				<div class="col-lg-12">
					<div class="source">
						Sources: compilation du <a target="_blank" href="https://gisanddata.maps.arcgis.com/apps/opsdashboard/index.html#/bda7594740fd40299423467b48e9ecf6">CSSE de l’Université Johns-Hopkins</a>,
						mise à jour le <span class="dataUpdate">30 janvier à 17h00 (heure suisse)</span> et basée sur des données
						de <a href="https://www.who.int/emergencies/diseases/novel-coronavirus-2019/situation-reports">l’OMS</a>,
						du <a href="https://www.cdc.gov/coronavirus/2019-ncov/index.html">CDC</a>,
						de la <a href="http://www.nhc.gov.cn/yjb/s3578/new_list.shtml">NHC</a>
						et de <a href="https://3g.dxy.cn/newh5/view/pneumonia?scene=2">DXY.cn</a></div>
				</div>
			</div>

			<div class="chart-background margin-top margin-bottom">
				<div class="row four-graphs">

					<div class="col-lg-6 col-md-12">
						<h5>Nouvelles guérisons et infections</h5>
						<p>Depuis le 18 février, on compte chaque jour plus de guérisons que de nouvelles infections confirmées. Le pic des 12 et 13 février a été causé par une <a target="_blank" href="https://www.letemps.ch/monde/coronavirus-bilan-morts-hausse-chine-apres-une-modification-mode-detection">nouvelle méthode de détection</a>.</p>
						<div class="c3-chart" id="chart-recoveries"></div>
						<!-- <div class="chart chart-china"></div> -->
						<!-- <div class="source">Source: <a target="_blank" href="https://donnees.banquemondiale.org/indicateur/NY.GDP.MKTP.CD?end=2018&start=2008">Banque mondiale</a></div> -->
					</div>


					<div class="col-lg-6 col-md-12">
						<h5>Ailleurs dans le monde</h5>
						<p>En-dehors de la Chine continentale, plusieurs centaines de cas ont été <a target="_blank" href="https://www.letemps.ch/sciences/diamond-princess-bouillon-culture-coronavirus">détectés sur le navire de croisière Diamond Princess</a>, en quarantaine dans la baie de Yokohama.</p>
						<!-- <div class="chart chart-other"></div> -->
						<div class="c3-chart" id="chart-china-other"></div>
						<!-- <div class="source">Source: Ilostat via la <a target="_blank" href="https://data.worldbank.org/indicator/SL.UEM.TOTL.NE.ZS?end=2018&locations=US&start=2008">Banque Mondiale</a></div> -->

					</div>
				</div>
			</div>

			<div class="row">
				<div class="offset-md-2 col-md-8 col-sm-12">

					<p><b>Lire aussi: </b> <a target="_blank" href="https://www.letemps.ch/monde/continu-virus-geneve-un-cas-confirme-salon-lhorlogerie-annule">[En continu] Le virus à Genève: un cas confirmé, le Salon de l'horlogerie annulé</a></p>

					<p class="credits">Infographies: Paul Ronga, code <a target="_blank" href="https://github.com/labsletemps/coronavirus-world-map-evolution">disponible sur GitHub</a> <a class="warn_error"></a></p>
				</div>
			</div>
		</div>

		


		<script src="lib/jquery-3.4.1.slim.min.js"></script>
		<script src="lib/ion.rangeSlider.js"></script>
		<script src="lib/bootstrap.min.js"></script>

		<!-- pies -->
		<script src="lib/d3.min.js"></script>
		<script src="lib/topojson.v2.min.js"></script>
		<script src="lib/d3-geo-projection.v2.min.js"></script>
		<script src="lib/d3-tip.js"></script>
		<script src="lib/queue.min.js"></script>
		<script src="js/chart-custom.js?UPDATE"></script>
		<script src="lib/c3.min.js"></script>

		<script src="js/map.js?UPDATE"></script>
		<script>

		$(document).ready(function() {
			// time-serie charts
			d3.csv("data/linegraphs.csv?UPDATE").then(function(data) {

				var total = [];
				var china = [];
				var other = [];

				data.forEach(function(d) {
					d.date = new Date(d.timestamp);
					china.push([d.date, +d.Mainland_China]);
					other.push([d.date, +d.Other_Locations]);
				});

				/*const chartChina = new Chart({
					element: document.querySelector('.chart-china'),
					data: china,
					suffix: ' cas',
					ylabel: 'Cas confirmés',
					dateParse: "%Y-%m-%d",
					dateFormat: "%d.%m."
				});

				const chartOther = new Chart({
					element: document.querySelector('.chart-other'),
					data: other,
					suffix: ' cas',
					ylabel: 'Cas confirmés',
					dateParse: "%Y-%m-%d",
					dateFormat: "%d.%m.",
				});*/

				var resizeTimeout;
				function resizeEvent(){
					clearTimeout(resizeTimeout);
					resizeTimeout = setTimeout(function(){
						chartChina.draw();
						chartOther.draw();
					}, 200);
				}
				d3.select(window).on('resize', resizeEvent );

			});

			if (window.fetch) {
				fetch('data/meta.json?UPDATE')
					.then(function(response) { return response.json(); })
					.then(function(data) {
						$('.warn_error').text('Signaler une erreur');
						$('<span>| </span>').insertBefore('.warn_error')
						$('.warn_error').attr('href', 'mailto:' + data['contact'] + '@letemps.ch');
						$('.deaths_total').text(data['deaths_total'])
						$('.confirmed_total').text(data['confirmed_total'])
						$('.confirmed_total_floor').text(Math.floor(data['confirmed_total'] / 1000) * 1000)
						$('.recovered_total').text(data['recovered_total'])
						$('.existing_total').text(data['existing_total'])


						$('.update').text(data['update'])
						$('.dataUpdate').text(data['dataUpdate'])
					});
				}

				/* c3 graphs bottom */
				var chart = c3.generate({
					padding: {
						right: 40,
    			},
					size: {
						height: 200
					},
					bindto: "#chart-recoveries",

					data: {
						url: 'data/c3-cas-guerisons.csv?UPDATE',
						type: 'line',
						x: 'timestamp',
						colors: {
							'Nouveaux cas': '#930025',
							'Nouvelles guérisons': '#4E8054'
						}
					},
					axis: {
						x: {
							type: 'timeseries',
							tick: {
								format: '%d.%m.%Y',
								count: 4
							},
						},
						y: {
							tick: {
							 	values: [0, 5000, 10000, 15000]
							}
						}
					},
					grid: {
						x: {
							lines: [
								{ value: '2018-02-12', label: 'Nouvelle méthode'},
							]
						}
					}
				}); // end c3js graph

				var chartCases = c3.generate({
					padding: {
						right: 40,
    			},
					size: {
						height: 200
					},
					bindto: "#chart-china-other",

					data: {
						url: 'data/c3-chine-etranger.csv?UPDATE',
						type: 'line',
						x: 'timestamp',
						colors: {
							'Nouveaux cas': '#930025',
							'Nouvelles guérisons': '#4E8054'
						}
					},
					axis: {
						x: {
							type: 'timeseries',
							tick: {
								format: '%d.%m.%Y',
								count: 4
							},
						},
						y: {
							tick: {
								 values: [0, 1000, 2000]
							}
						}
					},
				}); // end c3js graph
		});

		</script>


	</body>
	</html>
